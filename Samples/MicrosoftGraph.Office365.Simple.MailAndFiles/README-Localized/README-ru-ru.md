---
page_type: sample
products:
- office-outlook
- office-onedrive
- office-sp
- office-365
- ms-graph
languages:
- aspx
- csharp
extensions:
  contentType: samples
  technologies:
  - Microsoft Graph
  - Office UI Fabric
  - Azure AD
  services:
  - Outlook
  - OneDrive
  - SharePoint
  - Office 365
  createdDate: 1/1/2016 12:00:00 AM
---
# Microsoft Graph. Запросы личных файлов и сообщений электронной почты #

### Описание ###
Это простое приложение ASP.net MVC предназначено для запросов личных сообщений и файлов с использованием Microsoft Graph. Кроме того, в нем возможны динамические запросы AJAX на получение сведений. Кроме того, в этом примере используется Office UI Fabric, чтобы обеспечить согласованность пользовательского интерфейса со стандартными элементами управления и внешним видом.

### Сфера применения ###
-  Мультитенантная среда (MT) Office 365

### Предварительные требования ###
Конфигурация приложения в Azure AD

### Решение ###
Решение | Автор(ы)
---------|----------
Office365Api.Graph.Simple.MailAndFiles | Веса Ювонен

### Журнал версий ###
Версия | Дата | Примечания
---------| -----| --------
1.0 | 5 февраля 2016 г. | Первый выпуск

### Заявление об отказе от ответственности ###
**ЭТОТ КОД ПРЕДОСТАВЛЯЕТСЯ *КАК ЕСТЬ* БЕЗ КАКОЙ-ЛИБО ЯВНОЙ ИЛИ ПОДРАЗУМЕВАЕМОЙ ГАРАНТИИ, ВКЛЮЧАЯ ПОДРАЗУМЕВАЕМЫЕ ГАРАНТИИ ПРИГОДНОСТИ ДЛЯ КАКОЙ-ЛИБО ЦЕЛИ, ПРОДАЖИ ИЛИ ОТСУТСТВИЯ НАРУШЕНИЯ ПРАВ ИНЫХ ПРАВООБЛАДАТЕЛЕЙ.**

----------

# Введение #
В этом примере приложения демонстрируется упрощенный способ подключения к Microsoft Graph для отображения сообщений электронной почты и файлов отдельного пользователя. Обновление различных частей пользовательского интерфейса происходит автоматически при поступлении новых элементов в папку "Входящие" почтового ящика или добавлении новых элементов на принадлежащий пользователю сайт OneDrive для бизнеса.

![Пользовательский интерфейс приложения](http://i.imgur.com/Rt4d8Py.png)

# Настройка Azure Active Directory #
Чтобы обеспечить функционирование запросов Microsoft Graph, перед использованием этого примера нужно зарегистрировать приложение в Azure AD и предоставить необходимые разрешения. Создадим запись приложения в Azure Active Directory и настроим необходимые разрешения.

- Откройте пользовательский интерфейс портала Azure и перейдите к пользовательским интерфейсам Active Directory (на момент написания этой статьи эта возможность доступна только в старых пользовательских интерфейсах портала).
- Перейдите к выбору **приложений**
- Нажмите**Добавить**, чтобы начать создание нового приложения
- Нажмите**Добавить приложение, разрабатываемое моей организацией**

![Пользовательский интерфейс с учетом потребностей в Azure AD](http://i.imgur.com/dNtLtnl.png)

- Присвойте **имя** своему приложению и выберите **Веб-приложение и веб-интерфейс API** в качестве вида приложения

![Добавление пользовательского интерфейса приложения](http://i.imgur.com/BrxalG7.png)

- Обновите свойства приложения, как указано далее, для отладки
	- **URL-адрес** — https://localhost:44301/
	- **APP ID URL** — допустимый URL-адрес. Например http://pnpemailfiles.contoso.local — это просто идентификатор, поэтому он не должен быть действительным допустимым URL-адресом.

![Сведения о приложении в пользовательском интерфейсе](http://i.imgur.com/1IaNxLm.png)

- Перейдите к **настройке** страницы и раздела с ключами
- Выберите для генерируемого секрета период действия 1 или 2 года

![Настройка жизненного цикла секрета](http://i.imgur.com/7kX396J.png)

- Нажмите **Сохранить** и скопируйте со страницы сгенерированный секрет для использования в будущем. Примечание: секрет можно увидеть ТОЛЬКО в этот момент, поэтому его нужно сохранить в каком-либо другом месте.

![Секрет клиента](http://i.imgur.com/5vnkkTA.png)

- Прокрутите страницу вниз для настройки разрешений

![Разрешения для других приложений](http://i.imgur.com/tF4R75w.png)

- Выберите Office 365 Exchange Online и Office 365 SharePoint Online в качестве приложений, которым будут назначены разрешения

![Назначение разрешений](http://i.imgur.com/XGOba3Y.png)

- В разрешениях для Exchange Online предоставьте разрешение "**Чтение почты пользователя**"

![Выбор необходимых разрешений для Exchange](http://i.imgur.com/CyH9gg2.png)

- В разрешениях для SharePoint Online предоставьте разрешение "**Чтение файлов пользователя**"

![Выбор необходимых разрешений для SharePoint](http://i.imgur.com/NSZiHsh.png)

- Нажмите кнопку **Сохранить** 

Теперь необходимая настройка в той части, которая касается Azure Active Directory, завершена. Однако нужно еще настроить идентификатор клиента и секрет для файла web.config, входящего в проект. Обновление идентификатора клиента и ключей ClientSecret необходимо выполнить максимально тщательно.

![Конфигурация файла web.config](http://i.imgur.com/pihBvR5.png)

# Запуск решения #
После настройки службы Azure AD и обновления файла web.config путем ввода значений для вашей среды пример запустится должным образом.

- Нажмите клавишу F5 в Visual Studio.
- Щелкните**Подключение к Office 365** или **Вход**на панели набора, чтобы вызвать согласованный пользовательский интерфейс AAD для входа в нужный Azure AD

![Пользовательский интерфейс приложения](http://i.imgur.com/YMCrG4O.png)

- Выполните вход в приложение, используя нужные учетные данные Azure Active Directory

![Вход в Azure AD - Согласованный пользовательский интерфейс](http://i.imgur.com/gNz5Wgz.png)

- Отобразится пользовательский интерфейс приложения

![Пользовательский интерфейс приложения с личными данными](http://i.imgur.com/Rt4d8Py.png)


<img src="https://telemetry.sharepointpnp.com/pnp/samples/MicrosoftGraph.Office365.Simple.MailAndFiles" />