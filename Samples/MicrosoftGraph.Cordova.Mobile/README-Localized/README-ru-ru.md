---
page_type: sample
products:
- office-365
- office-excel
- office-planner
- office-teams
- office-outlook
- office-onedrive
- office-sp
- office-onenote
- ms-graph
languages:
- javascript
extensions:
  contentType: samples
  technologies:
  - Microsoft Graph
  - Azure AD
  services:
  - Office 365
  - Excel
  - Planner
  - Microsoft Teams
  - Outlook
  - OneDrive
  - SharePoint
  - OneNote
  platforms:
  - REST API
  createdDate: 1/1/2016 12:00:00 AM
  scenarios:
  - Mobile
---
# Пример использования Microsoft Graph с Apache Cordova и ADAL модуль Cordova #

### Обзор ###
В этом примере показано, как использовать API Microsoft Graph для получения данных из Office 365
с помощью REST API и OData. Это пример намеренно упрощен, поэтому в нем не используются платформы SPA,
библиотека привязки данных, jQuery и т. д. Он не рассчитан на демонстрацию полноценного мобильного приложения.
Вы можете создавать решения для различных платформ Windows,
а также Android и iOS,
используя один и тот же код JavaScript.

Токен доступа предоставляется с помощью подключаемого модуля ADAL Cordova.
Это один из основных подключаемых модулей Visual Studio, который доступен в редакторе config.xml
Это альтернатива мастеру добавления подключенной службы, который генерирует ряд файлов JavaScript,
включая библиотеку (o365auth.js), которую можно использовать для получения
токенов с помощью браузера в приложении для обработки перенаправления пользователя на конечную точку авторизации.
Вместо этого плагин ADAL Cordova использует собственные библиотеки ADAL для каждой платформы и поэтому может использовать
преимущества собственных функций,
таких как кэширование токенов и усиленные браузеры.

### Сфера применения ###
-  Мультитенантная среда (MT) Office 365
-  Microsoft Graph

### Предварительные требования ###
- Инструменты Visual Studio для Apache Cordova (опция настройки VS-TACO)
- Подключаемый модуль Cordova (Cordova-подключаемый модуль—MS-ADAL)

### Решение ###
Решение | Автор (ы)
--------- | ----------
Mobile.MicrosoftGraphCordova | Билл Айерс (@SPDoctor, spdoctor.com, flosim.com)

### Журнал версий ###
Версия | Дата | Комментарии
--------- | ----- | --------
1.0 | 15 марта 2016 | Первый выпуск

### Заявление об отказе ###
**ЭТОТ КОД ПРЕДОСТАВЛЯЕТСЯ *КАК ЕСТЬ* БЕЗ КАКОЙ-ЛИБО ЯВНОЙ ИЛИ ПОДРАЗУМЕВАЕМОЙ ГАРАНТИИ, ВКЛЮЧАЯ ПОДРАЗУМЕВАЕМЫЕ ГАРАНТИИ ПРИГОДНОСТИ ДЛЯ КАКОЙ-ЛИБО ЦЕЛИ, ДЛЯ ПРОДАЖИ ИЛИ ГАРАНТИИ ОТСУТСТВИЯ НАРУШЕНИЯ ПРАВ ИНЫХ ПРАВООБЛАДАТЕЛЕЙ.**


----------

### Запуск образца ###

После запуска образца вы можете нажать кнопку «Загрузить данные».
Если вы запускаете его впервые, вам будет предложено авторизовать приложение.
Это знакомая подсказка для входа в Office 365.
Поскольку мы используем Microsoft Graph,
также можно использовать «учетную запись Microsoft» (т.е. учетную запись live.com или hotmail). 

Если вы ввели имя клиента Office 365,
оно будет работать с этой учетной записью.
Если вы оставите арендатора пустым, то будет использоваться «Общая» конечная точка,
а фактический используемый арендатор будет определяться на основе учетных данных пользователя, используемых для аутентификации в конечной точке авторизации.

Вы можете ввести действительный запрос в поле ввода (хотя не все будут проанализированы без изменения кода).
В качестве альтернативы вы можете выбрать из выпадающего
списка и выбрать предварительно созданный запрос.

![Работает на Windows 10](MicrosoftGraphCordova.png)

Как только токен получен, он анализируется и отображается только для демонстрационных целей.
Токен не зашифрован (следовательно, необходима защита транспортного уровня, такого как SSL),
но его следует рассматривать как непрозрачный, другими словами, не пишите код, который опирается на информацию,
содержащуюся в токене, - используйте вместо этого API-интерфейсы.

Используя токен доступа, выполняется запрос REST к API Microsoft Graph и данные отображаются.
Вы можете заметить задержку между получением токена и возвращением данных из конечной точки REST.
Обратите внимание, что библиотеку ADAL можно также использовать для получения
токенов для исходных конечных точек Office 365 REST,
но в примере кода область действия была установлена в Microsoft Graph.

Вы можете видеть, что срок действия токена доступа составляет около часа.
Вы можете продолжать делать дальнейшие запросы, используя токен, пока он не истечет без дальнейших запросов.
Это работает, даже если вы закроете приложение и запустите его снова,
потому что токен кэшируется. Через час срок действия токена истекает,
и токен обновления используется для получения нового токена доступа.
Это также приводит к появлению нового токена обновления, и этот процесс может повторяться в течение нескольких месяцев, пока токен обновления,
который также кэшируется, не истекает.

Если вы нажмете кнопку «Очистить кэш», кэш токена будет очищен.
При следующем нажатии кнопки «Загрузить данные» вы получите запрос на авторизацию. 

### В фоновом режиме ###

Все управление кэшем (которое зависит от платформы),
связанное с маркерами доступа с истекшим сроком действия и использованием маркера обновления,
осуществляется библиотеками ADAL. Вам просто нужно получить контекст аутентификации и следовать текущему рекомендуемому шаблону,
который должен сначала вызвать acquireTokenSilentAsync.
Если токен не может быть получен без вывода сообщений (т. Е. Из кэша или с помощью токена обновления),
обратный вызов «неудача» затем вызывает acquireTokenAsync,
для которого поведение подсказки установлено на «Всегда».

```javascript

    context.acquireTokenSilentAsync(resourceUrl, appId).then(success, function () {
      context.acquireTokenAsync(resourceUrl, appId, redirectUrl).then(success, fail);
    });

```

Хотя текущая документация и некоторые из библиотек ADAL имеют acquireTokenAsync с параметром «Поведение подсказки»,
установленным на «авто», что означает приглашение пользователя только в случае необходимости,
дизайн плагина Cordova заключается в том, что acquireTokenAsync всегда будет запрашивать. 

Примечание. Я понимаю, что остальные библиотеки ADAL будут использовать этот шаблон в будущем. 


<img src="https://telemetry.sharepointpnp.com/pnp/samples/MicrosoftGraph.Cordova.Mobile" />